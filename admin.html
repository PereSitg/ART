<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="UTF-8">
    <title>Admin - Sitges Art & Història</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .card { border: 1px solid #e2e8f0; border-radius: 8px; padding: 1rem; margin-bottom: 1rem; }
    </style>
</head>
<body class="bg-gray-50 p-8">

    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold mb-6 text-blue-900">Gestor de Continguts SitgesArt</h1>

        <div class="bg-white p-6 rounded-xl shadow-md mb-8">
            <h2 class="text-xl font-semibold mb-4">Afegir Nova Entrada (Manual o Criticartt)</h2>
            <div class="grid grid-cols-1 gap-4">
                <input type="text" id="nom" placeholder="Nom de l'obra o lloc (Ex: Can Falç)" class="border p-2 rounded">
                <select id="tipus" class="border p-2 rounded">
                    <option value="Modernisme">Modernisme</option>
                    <option value="Història Local">Història Local (Criticartt)</option>
                    <option value="Arquitectura">Arquitectura</option>
                    <option value="Cinema">Cinema</option>
                    <option value="Art Contemporani">Art Contemporani</option>
                </select>
                <textarea id="resum" placeholder="Resum curt per al cercador..." class="border p-2 rounded h-20"></textarea>
                <textarea id="explicacio" placeholder="Història completa o anècdota..." class="border p-2 rounded h-32"></textarea>
                <input type="text" id="url" placeholder="URL de la font (ex: criticartt.blogspot.com)" class="border p-2 rounded">
                <button onclick="guardarDada()" class="bg-blue-600 text-white font-bold py-2 rounded hover:bg-blue-700">Guardar a la Base de Dades</button>
            </div>
        </div>

        <div class="bg-white p-6 rounded-xl shadow-md">
            <h2 class="text-xl font-semibold mb-4">Contingut a la Base de Dades</h2>
            <div id="llista-contingut" class="space-y-4">
                <p class="text-gray-500 italic">Carregant dades...</p>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, onSnapshot } 
        from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            // ENGANXA AQUÍ LES TEVES CREDENCIALS DE FIREBASE
            apiKey: "TEU_API_KEY",
            authDomain: "TEU_PROJECTE.firebaseapp.com",
            projectId: "TEU_PROJECTE_ID",
            storageBucket: "TEU_PROJECTE.appspot.com",
            messagingSenderId: "TEU_SENDER_ID",
            appId: "TEU_APP_ID"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // FUNCIO PER GUARDAR
        window.guardarDada = async () => {
            const nom = document.getElementById('nom').value;
            const tipus = document.getElementById('tipus').value;
            const resum = document.getElementById('resum').value;
            const explicacio = document.getElementById('explicacio').value;
            const url = document.getElementById('url').value;

            if(!nom || !explicacio) return alert("Falten camps!");

            try {
                await addDoc(collection(db, "obres"), {
                    nom: nom,
                    tipus: tipus,
                    resum: resum,
                    analisis_obres: [{ titol: "Història i Detalls", explicacio_artistica: explicacio }],
                    url: url,
                    data_creacio: new Date()
                });
                alert("Guardat correctament!");
                document.querySelectorAll('input, textarea').forEach(el => el.value = "");
            } catch (e) { console.error("Error: ", e); }
        };

        // LLEGIR EN TEMPS REAL
        onSnapshot(collection(db, "obres"), (querySnapshot) => {
            const llista = document.getElementById('llista-contingut');
            llista.innerHTML = "";
            querySnapshot.forEach((d) => {
                const item = d.data();
                llista.innerHTML += `
                    <div class="card bg-gray-50 flex justify-between items-start">
                        <div>
                            <span class="text-xs font-bold uppercase text-blue-600">${item.tipus}</span>
                            <h3 class="text-lg font-bold">${item.nom}</h3>
                            <p class="text-sm text-gray-600">${item.resum || ''}</p>
                        </div>
                        <button onclick="window.eliminarDada('${d.id}')" class="text-red-500 hover:underline text-sm">Eliminar</button>
                    </div>
                `;
            });
        });

        window.eliminarDada = async (id) => {
            if(confirm("Segur que vols eliminar aquesta història?")) {
                await deleteDoc(doc(db, "obres", id));
            }
        };
    </script>
</body>
</html>
