<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, getDocs, updateDoc, doc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyAV8SrQ3tDiixCRwUDgC33jI8ZJzlcceZc",
        authDomain: "sitgesart.firebaseapp.com",
        projectId: "sitgesart",
        storageBucket: "sitgesart.firebasestorage.app",
        messagingSenderId: "673959867307",
        appId: "1:673959867307:web:80607c11d79db42b4918ee"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    async function correccioAgressiva() {
        const detalls = document.getElementById('detalls');
        const querySnapshot = await getDocs(collection(db, "obres"));
        let total = 0;

        for (const document_ de querySnapshot.docs) {
            const data = document_.data();
            const link = data.link ? data.link.toLowerCase() : "";
            
            // Si el link conté "criticart", l'arreglem sí o sí
            if (link.includes("criticart.com")) {
                await updateDoc(doc(db, "obres", document_.id), {
                    font: "CRITICART",
                    origen: "Crítica d'Art de Sitges"
                });
                detalls.innerHTML += `Corregit: ${data.nom}<br>`;
                total++;
            }
        }
        document.getElementById('estat').innerText = "✅ FET! " + total + " corregits.";
    }
    correccioAgressiva();
</script>
