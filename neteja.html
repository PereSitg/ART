<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Neteja Sitges Art</title>
</head>
<body>
    <h1 id="estat">Treballant...</h1>
    <div id="llista"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, getDocs, updateDoc, doc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAV8SrQ3tDiixCRwUDgC33jI8ZJzlcceZc",
            authDomain: "sitgesart.firebaseapp.com",
            projectId: "sitgesart",
            storageBucket: "sitgesart.firebasestorage.app",
            messagingSenderId: "673959867307",
            appId: "1:673959867307:web:80607c11d79db42b4918ee"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        async function executar() {
            const estat = document.getElementById('estat');
            const llista = document.getElementById('llista');
            
            try {
                const snapshot = await getDocs(collection(db, "obres"));
                let total = 0;

                for (const docSnap of snapshot.docs) {
                    const dades = docSnap.data();
                    const textLink = dades.link || "";

                    if (textLink.includes("criticart.com")) {
                        await updateDoc(doc(db, "obres", docSnap.id), {
                            font: "CRITICART",
                            origen: "Crítica d'Art de Sitges"
                        });
                        llista.innerHTML += "✅ Corregit: " + dades.nom + "<br>";
                        total++;
                    }
                }
                estat.innerText = "FET! Corregits: " + total;
            } catch (err) {
                estat.innerText = "Error de connexió";
                llista.innerHTML = err.message;
            }
        }

        executar();
    </script>
</body>
</html>
