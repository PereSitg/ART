<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Correcci√≥ Final SitgesArt</title>
</head>
<body style="font-family: sans-serif; padding: 20px;">
    <h1 id="estat">Corregint dades de Criticartt...</h1>
    <div id="llista" style="background: #f0f0f0; padding: 15px; border-radius: 8px;"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, getDocs, updateDoc, doc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAV8SrQ3tDiixCRwUDgC33jI8ZJzlcceZc",
            authDomain: "sitgesart.firebaseapp.com",
            projectId: "sitgesart",
            storageBucket: "sitgesart.firebasestorage.app",
            messagingSenderId: "673959867307",
            appId: "1:673959867307:web:80607c11d79db42b4918ee"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        async function corregir() {
            const estat = document.getElementById('estat');
            const llista = document.getElementById('llista');
            
            try {
                const snapshot = await getDocs(collection(db, "obres"));
                let total = 0;

                for (const docSnap of snapshot.docs) {
                    const d = docSnap.data();
                    const link = (d.link || "").toLowerCase();

                    // Busquem criticart amb una o dues "t"
                    if (link.includes("criticart.blogspot") || link.includes("criticartt.blogspot")) {
                        await updateDoc(doc(db, "obres", docSnap.id), {
                            font: "CRITICART",
                            origen: "Cr√≠tica d'Art de Sitges"
                        });
                        llista.innerHTML += "‚úÖ Arreglat: " + d.nom + "<br>";
                        total++;
                    }
                }
                estat.innerText = "üéâ FET! S'han corregit " + total + " entrades.";
            } catch (err) {
                estat.innerText = "‚ùå Error de permisos o connexi√≥";
                llista.innerHTML = err.message;
            }
        }

        corregir();
    </script>
</body>
</html>
