<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="UTF-8">
    <title>SitgesArt - Correcci√≥ de Dades</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-900 text-white p-10 flex flex-col items-center">

    <div class="max-w-xl w-full bg-slate-800 p-8 rounded-3xl shadow-xl text-center">
        <h1 class="text-2xl font-bold mb-4">Corregir "Criticartt" üõ†Ô∏è</h1>
        <p class="text-slate-400 mb-8">Aquest proc√©s canviar√† totes les fonts mal escrites de la base de dades.</p>
        
        <button onclick="corregirNoms()" id="btn-fix" class="bg-blue-600 hover:bg-blue-700 text-white px-8 py-4 rounded-2xl font-bold transition-all">
            INICIAR CORRECCI√ì ARA
        </button>

        <div id="log" class="mt-8 text-left font-mono text-xs text-blue-400 bg-black p-4 rounded-xl h-40 overflow-y-auto">
            > Esperant instruccions...
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, getDocs, updateDoc, doc, query, where } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAV8SrQ3tDiixCRwUDgC33jI8ZJzlcceZc",
            authDomain: "sitgesart.firebaseapp.com",
            projectId: "sitgesart",
            storageBucket: "sitgesart.firebasestorage.app",
            messagingSenderId: "673959867307",
            appId: "1:673959867307:web:80607c11d79db42b4918ee"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        function log(msg) {
            const l = document.getElementById('log');
            l.innerHTML += `<div>> ${msg}</div>`;
            l.scrollTop = l.scrollHeight;
        }

        window.corregirNoms = async () => {
            const btn = document.getElementById('btn-fix');
            btn.disabled = true;
            btn.innerText = "TREBALLANT...";
            
            try {
                log("Buscant errors a la base de dades...");
                
                // Busquem nom√©s els que tenen la doble T
                const q = query(collection(db, "obres"), where("font", "==", "Criticartt"));
                const snap = await getDocs(q);
                
                if (snap.empty) {
                    log("No s'ha trobat cap registre amb 'Criticartt'. Tot est√† correcte!");
                    btn.innerText = "NET ‚úÖ";
                    return;
                }

                log(`S'han trobat ${snap.size} errors. Comen√ßant actualitzaci√≥...`);

                let comptador = 0;
                for (const document of snap.docs) {
                    const docRef = doc(db, "obres", document.id);
                    await updateDoc(docRef, { font: "Criticart" });
                    comptador++;
                    log(`Actualitzat (${comptador}/${snap.size}): ${document.data().nom}`);
                }

                log("üéâ PROC√âS FINALITZAT AMB √àXIT!");
                btn.innerText = "CORRECCI√ì FETA";

            } catch (e) {
                log("ERROR: " + e.message);
                btn.disabled = false;
            }
        };
    </script>
</body>
</html>
