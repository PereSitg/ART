<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="UTF-8">
    <title>SitgesArt - Entrada R√†pida</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <style>
        body { background: #020617; color: white; font-family: sans-serif; min-height: 100vh; display: flex; align-items: center; justify-content: center; }
        .input-field { background: #0f172a; border: 1px solid #334155; border-radius: 12px; padding: 12px; width: 100%; color: white; margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; color: #94a3b8; font-size: 0.85rem; font-weight: 600; }
        .hidden { display: none; }
    </style>
</head>
<body>

    <div id="login-card" class="bg-slate-900 border border-slate-800 p-10 rounded-3xl shadow-2xl text-center">
        <h1 class="text-2xl font-bold mb-6">üîí Acc√©s Protegit</h1>
        <button onclick="login()" class="bg-white text-black font-bold py-3 px-8 rounded-full hover:bg-slate-200 transition-all">
            Identifica't com Admin
        </button>
    </div>

    <div id="form-card" class="bg-slate-900 border border-slate-800 p-8 rounded-3xl shadow-2xl w-full max-w-2xl hidden">
        <div class="flex justify-between items-center mb-6">
            <h1 class="text-2xl font-black text-blue-400">SITGES ART EXPRESS ‚ö°</h1>
            <span id="user-email" class="text-xs text-slate-500"></span>
        </div>

        <label>1. Tria un personatge de la llista:</label>
        <select id="selector" class="input-field border-blue-500/50 bg-slate-800 cursor-pointer" onchange="carregarDades()">
            <option value="">-- Selecciona per auto-completar --</option>
        </select>

        <div class="grid grid-cols-2 gap-4">
            <div>
                <label>Nom</label>
                <input type="text" id="nom" class="input-field">
            </div>
            <div>
                <label>Font</label>
                <input type="text" id="font" class="input-field">
            </div>
        </div>

        <label>URL (Viquip√®dia / Web)</label>
        <input type="text" id="url" class="input-field text-blue-300 text-sm">

        <label>Resum per a la web</label>
        <textarea id="resum" class="input-field h-32 text-sm leading-relaxed"></textarea>

        <button onclick="guardarAFirebase()" id="btn-save" class="w-full bg-blue-600 hover:bg-blue-500 text-white font-bold py-4 rounded-xl shadow-lg shadow-blue-900/20 transition-all">
            GUARDAR ARA MATEIX
        </button>
        
        <p id="status" class="mt-4 text-center font-bold"></p>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAV8SrQ3tDiixCRwUDgC33jI8ZJzlcceZc",
            authDomain: "sitgesart.firebaseapp.com",
            projectId: "sitgesart",
            storageBucket: "sitgesart.firebasestorage.app",
            messagingSenderId: "673959867307",
            appId: "1:673959867307:web:80607c11d79db42b4918ee"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const provider = new GoogleAuthProvider();

        // BASE DE DADES INTERNA PER ANAR R√ÄPID
        const dadesPersonatges = {
            "Felip Mas√≥": { font: "Viquip√®dia", url: "https://ca.wikipedia.org/wiki/Felip_Mas√≥_i_de_Falguera", resum: "Pintor sitget√† de l'Escola Luminista, fam√≥s per les seves escenes de platja i costumisme local." },
            "Emili Grau Sala": { font: "Viquip√®dia", url: "https://ca.wikipedia.org/wiki/Emili_Grau_i_Sala", resum: "Pintor de projecci√≥ internacional associat a l'Escola de Par√≠s, conegut pel seu estil elegant i colorista." },
            "Joan Llaverias": { font: "Viquip√®dia", url: "https://ca.wikipedia.org/wiki/Joan_Llaverias_i_Labr√≥", resum: "Dibuixant i pintor modernista, membre fundador del Cercle Art√≠stic de Sant Lluc i gran aquarel¬∑lista." },
            "Pere Pruna": { font: "Viquip√®dia", url: "https://ca.wikipedia.org/wiki/Pere_Pruna_i_Ocerans", resum: "Pintor vinculat al Noucentisme, deixeble de Picasso, amb una obra centrada en la delicadesa de la figura femenina." },
            "Joan Maragall": { font: "Viquip√®dia", url: "https://ca.wikipedia.org/wiki/Joan_Maragall_i_Gorina", resum: "Poeta cabdal del Modernisme catal√†, gran amic de Rusi√±ol i participant actiu de les Festes Modernistes." },
            "J.V. Foix": { font: "Viquip√®dia", url: "https://ca.wikipedia.org/wiki/J._V._Foix", resum: "Poeta i assagista d'avantguarda, figura clau de la cultura catalana i col¬∑laborador de 'L'Amic de les Arts'." },
            "Marta Pessarrodona": { font: "Viquip√®dia", url: "https://ca.wikipedia.org/wiki/Marta_Pessarrodona_i_Artigues", resum: "Poeta i cr√≠tica liter√†ria, resident a Sitges i Premi d'Honor de les Lletres Catalanes (2019)." },
            "Francesc Gum√† i Ferran": { font: "Viquip√®dia", url: "https://ca.wikipedia.org/wiki/Francesc_Gum√†_i_Ferran", resum: "Empresari i pol√≠tic que va impulsar l'arribada del ferrocarril a Sitges, canviant per sempre l'economia de la vila." },
            "Gaiet√† Bu√Øgas": { font: "Viquip√®dia", url: "https://ca.wikipedia.org/wiki/Gaiet√†_Bu√Øgas_i_Monrav√†", resum: "Arquitecte modernista conegut pel Monument a Colom a Barcelona i diverses cases senyorials a Sitges." },
            "Enric Morera": { font: "Viquip√®dia", url: "https://ca.wikipedia.org/wiki/Enric_Morera_i_Viura", resum: "Compositor de sardanes i m√∫sica coral, estretament lligat al moviment modernista de Sitges." },
            "Jordi Mil√°n": { font: "Web", url: "https://ca.wikipedia.org/wiki/Jordi_Mil√°n", resum: "Director teatral i fundador de la companyia La Cubana, nascuda a Sitges i referent de l'humor catal√†." },
            "√Ängel Sala": { font: "Viquip√®dia", url: "https://ca.wikipedia.org/wiki/√Ängel_Sala_i_Vila", resum: "Escriptor i cr√≠tic de cinema, director del Festival Internacional de Cinema Fant√†stic de Catalunya (Sitges)." },
            "Trinitat Catas√∫s": { font: "Viquip√®dia", url: "https://ca.wikipedia.org/wiki/Trinitat_Catas√∫s_i_Catas√∫s", resum: "Enginyer i poeta noucentista sitget√†, conegut pel seu rigor formal i amor a la terra." },
            "Santi Mill√°n": { font: "Viquip√®dia", url: "https://ca.wikipedia.org/wiki/Santi_Mill√°n", resum: "Actor i presentador de televisi√≥ que va iniciar la seva carrera a Sitges amb la companyia La Cubana." },
            "Llu√≠s Jou": { font: "Viquip√®dia", url: "https://ca.wikipedia.org/wiki/Llu√≠s_Jou_i_Senabre", resum: "Eminent gravador i tip√≤graf que va escollir Sitges per instal¬∑lar el seu taller de bibliof√≠lia." }
        };

        // Identificaci√≥
        onAuthStateChanged(auth, (user) => {
            if (user && user.email === "pbadialorenz@gmail.com") {
                document.getElementById('login-card').classList.add('hidden');
                document.getElementById('form-card').classList.remove('hidden');
                document.getElementById('user-email').innerText = user.email;
                carregarLlista();
            }
        });

        window.login = () => signInWithPopup(auth, provider);

        function carregarLlista() {
            const selector = document.getElementById('selector');
            for (let nom in dadesPersonatges) {
                let opt = document.createElement('option');
                opt.value = nom;
                opt.innerText = nom;
                selector.appendChild(opt);
            }
        }

        window.carregarDades = () => {
            const sel = document.getElementById('selector').value;
            if (dadesPersonatges[sel]) {
                document.getElementById('nom').value = sel;
                document.getElementById('font').value = dadesPersonatges[sel].font;
                document.getElementById('url').value = dadesPersonatges[sel].url;
                document.getElementById('resum').value = dadesPersonatges[sel].resum;
            }
        };

        window.guardarAFirebase = async () => {
            const status = document.getElementById('status');
            const btn = document.getElementById('btn-save');
            
            const docData = {
                nom: document.getElementById('nom').value,
                font: document.getElementById('font').value,
                link: document.getElementById('url').value,
                resum: document.getElementById('resum').value,
                data_entrada: new Date().toISOString()
            };

            if (!docData.nom) return alert("Tria un personatge primer!");

            try {
                btn.disabled = true;
                status.innerText = "‚è≥ Guardant a Firebase...";
                await addDoc(collection(db, "obres"), docData);
                status.innerText = "‚úÖ Guardat correctament!";
                status.className = "mt-4 text-center font-bold text-green-400";
                
                // Neteja per al seg√ºent
                setTimeout(() => {
                    status.innerText = "";
                    document.getElementById('nom').value = "";
                    document.getElementById('resum').value = "";
                    document.getElementById('url').value = "";
                    document.getElementById('selector').value = "";
                }, 2000);

            } catch (e) {
                status.innerText = "‚ùå Error: " + e.message;
                status.className = "mt-4 text-center font-bold text-red-400";
                console.error(e);
            } finally {
                btn.disabled = false;
            }
        };
    </script>
</body>
</html>
