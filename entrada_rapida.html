<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="UTF-8">
    <title>SitgesArt - Entrada R√†pida</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <style>
        body { background: #020617; color: white; font-family: sans-serif; min-height: 100vh; display: flex; align-items: center; justify-content: center; }
        .input-field { background: #0f172a; border: 1px solid #334155; border-radius: 12px; padding: 12px; width: 100%; color: white; margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; color: #94a3b8; font-size: 0.85rem; font-weight: 600; }
        .hidden { display: none; }
    </style>
</head>
<body>

    <div id="login-card" class="bg-slate-900 border border-slate-800 p-10 rounded-3xl shadow-2xl text-center">
        <h1 class="text-2xl font-bold mb-6">üîí Acc√©s Protegit</h1>
        <button onclick="login()" class="bg-white text-black font-bold py-3 px-8 rounded-full hover:bg-slate-200 transition-all">
            Identifica't com Admin
        </button>
    </div>

    <div id="form-card" class="bg-slate-900 border border-slate-800 p-8 rounded-3xl shadow-2xl w-full max-w-2xl hidden">
        <div class="flex justify-between items-center mb-6">
            <h1 class="text-2xl font-black text-blue-400">SITGES ART EXPRESS ‚ö°</h1>
            <span id="user-email" class="text-xs text-slate-500"></span>
        </div>

        <label>1. Tria un personatge de la llista:</label>
        <select id="selector" class="input-field border-blue-500/50 bg-slate-800 cursor-pointer" onchange="carregarDades()">
            <option value="">-- Selecciona per auto-completar --</option>
        </select>

        <div class="grid grid-cols-2 gap-4">
            <div>
                <label>Nom</label>
                <input type="text" id="nom" class="input-field">
            </div>
            <div>
                <label>Font</label>
                <input type="text" id="font" class="input-field">
            </div>
        </div>

        <label>URL (Viquip√®dia / Web)</label>
        <input type="text" id="url" class="input-field text-blue-300 text-sm">

        <label>Resum per a la web</label>
        <textarea id="resum" class="input-field h-32 text-sm leading-relaxed"></textarea>

        <button onclick="guardarAFirebase()" id="btn-save" class="w-full bg-blue-600 hover:bg-blue-500 text-white font-bold py-4 rounded-xl shadow-lg shadow-blue-900/20 transition-all">
            GUARDAR ARA MATEIX
        </button>
        
        <p id="status" class="mt-4 text-center font-bold"></p>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAV8SrQ3tDiixCRwUDgC33jI8ZJzlcceZc",
            authDomain: "sitgesart.firebaseapp.com",
            projectId: "sitgesart",
            storageBucket: "sitgesart.firebasestorage.app",
            messagingSenderId: "673959867307",
            appId: "1:673959867307:web:80607c11d79db42b4918ee"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const provider = new GoogleAuthProvider();

        // BASE DE DADES INTERNA PER ANAR R√ÄPID
        const dadesPersonatges = {
            "Iris L√°zaro": { font: "Viquip√®dia", url: "https://ca.wikipedia.org/wiki/Iris_L√°zaro_i_Garc√≠a", resum: "Pintora realista resident a Sitges, coneguda per la seva minuciositat i la seva interpretaci√≥ po√®tica dels paisatges." },
            "Josep Maria Llopis de Cellers": { font: "Viquip√®dia", url: "https://ca.wikipedia.org/wiki/Josep_Maria_Llopis_de_Cellers", resum: "Dibuixant i arquitecte sitget√†, autor d'importants treballs gr√†fics sobre la vila i la seva hist√≤ria." },
            "Carlos V√°zquez": { font: "Viquip√®dia", url: "https://ca.wikipedia.org/wiki/Carlos_V√°zquez_√öbeda", resum: "Pintor i il¬∑lustrador que va tenir una forta vinculaci√≥ amb el Modernisme i el grup de pintors de Sitges." },
            "Josep Planes i Pe√±alver": { font: "Viquip√®dia", url: "https://ca.wikipedia.org/wiki/Josep_Planes_i_Pe√±alver", resum: "Escultor d'obra reconeguda que va contribuir a la riquesa del patrimoni art√≠stic sitget√† del segle XX." },
            "C√°ndida P√©rez": { font: "Viquip√®dia", url: "https://ca.wikipedia.org/wiki/C√†ndida_P√©rez_i_Mart√≠nez", resum: "Compositora sitgetana de cuplets molt famosa als anys 20, autora del conegut 'El relicario'." },
            "Salvador Soler i Forment": { font: "Viquip√®dia", url: "https://ca.wikipedia.org/wiki/Salvador_Soler_i_Forment", resum: "Periodista i poeta sitget√†, gran defensor de la cultura local i cronista de la vida social de la vila." },
            "Miquel de Sitges": { font: "Viquip√®dia", url: "https://ca.wikipedia.org/wiki/Miquel_de_Sitges", resum: "Religi√≥s caputx√≠ i escriptor, una figura intel¬∑lectual destacada dins de l'orde i amb or√≠gens a la vila." },
            "Gumersind Riera": { font: "Viquip√®dia", url: "https://ca.wikipedia.org/wiki/Gumersind_Riera_i_Sans", resum: "Poeta d'origen menorqu√≠ establert a Sitges, molt actiu en els cert√†mens literaris locals." },
            "Rafael Casanova": { font: "Viquip√®dia", url: "https://ca.wikipedia.org/wiki/Rafael_Casanova_i_Aug√©", resum: "Escriptor i activista cultural sitget√†, autor de diversos estudis sobre el folklore i la hist√≤ria de la vila." },
            "Josep Galofre": { font: "Viquip√®dia", url: "https://ca.wikipedia.org/wiki/Josep_Galofre_i_Coma", resum: "Pintor hist√≤ric catal√† del segle XIX amb relaci√≥ amb els cercles art√≠stics que freq√ºentaven Sitges." },
            "Jaume Figueras": { font: "Web", url: "https://ca.wikipedia.org/wiki/Jaume_Figueras", resum: "Cr√≠tic de cinema i gran divulgador cultural, molt vinculat al Festival de Sitges des dels seus inicis." },
            "Antoni Mesa": { font: "Web", url: "https://www.l'eco.cat", resum: "Historiador i col¬∑laborador de L'Eco de Sitges, expert en la genealogia i les fam√≠lies de la vila." },
            "Janio Marti": { font: "Viquip√®dia", url: "https://ca.wikipedia.org/wiki/Janio_Marti", resum: "M√∫sic i director d'orquestra sitget√†, una instituci√≥ en el m√≥n de les festes majors i el ball d'envelat." },
            "Gabriel Pallar√®s": { font: "Viquip√®dia", url: "https://ca.wikipedia.org/wiki/Gabriel_Pallar√®s_i_Roig", resum: "Compositor i m√∫sic sitget√†, autor de nombroses peces per a cobla i sardanes molt estimades." },
            "Franciscu de Sitges": { font: "Llegendes", url: "https://ca.wikipedia.org/wiki/Cultura_de_Sitges", resum: "Personatge popular i llegendari de la vila, part de l'imaginari col¬∑lectiu i la tradici√≥ oral sitgetana." }
        };

        // Identificaci√≥
        onAuthStateChanged(auth, (user) => {
            if (user && user.email === "pbadialorenz@gmail.com") {
                document.getElementById('login-card').classList.add('hidden');
                document.getElementById('form-card').classList.remove('hidden');
                document.getElementById('user-email').innerText = user.email;
                carregarLlista();
            }
        });

        window.login = () => signInWithPopup(auth, provider);

        function carregarLlista() {
            const selector = document.getElementById('selector');
            for (let nom in dadesPersonatges) {
                let opt = document.createElement('option');
                opt.value = nom;
                opt.innerText = nom;
                selector.appendChild(opt);
            }
        }

        window.carregarDades = () => {
            const sel = document.getElementById('selector').value;
            if (dadesPersonatges[sel]) {
                document.getElementById('nom').value = sel;
                document.getElementById('font').value = dadesPersonatges[sel].font;
                document.getElementById('url').value = dadesPersonatges[sel].url;
                document.getElementById('resum').value = dadesPersonatges[sel].resum;
            }
        };

        window.guardarAFirebase = async () => {
            const status = document.getElementById('status');
            const btn = document.getElementById('btn-save');
            
            const docData = {
                nom: document.getElementById('nom').value,
                font: document.getElementById('font').value,
                link: document.getElementById('url').value,
                resum: document.getElementById('resum').value,
                data_entrada: new Date().toISOString()
            };

            if (!docData.nom) return alert("Tria un personatge primer!");

            try {
                btn.disabled = true;
                status.innerText = "‚è≥ Guardant a Firebase...";
                await addDoc(collection(db, "obres"), docData);
                status.innerText = "‚úÖ Guardat correctament!";
                status.className = "mt-4 text-center font-bold text-green-400";
                
                // Neteja per al seg√ºent
                setTimeout(() => {
                    status.innerText = "";
                    document.getElementById('nom').value = "";
                    document.getElementById('resum').value = "";
                    document.getElementById('url').value = "";
                    document.getElementById('selector').value = "";
                }, 2000);

            } catch (e) {
                status.innerText = "‚ùå Error: " + e.message;
                status.className = "mt-4 text-center font-bold text-red-400";
                console.error(e);
            } finally {
                btn.disabled = false;
            }
        };
    </script>
</body>
</html>
